__NUXT_JSONP__("/posts/arangodb-comments", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa){return {data:[{blockMap:{"009af739-32c9-4247-8d75-69db84eae7f7":{value:{id:f,version:857,type:"page",properties:{"0#}p":[[q,[["d",{type:"date",start_date:r}]]]],"IWg]":[[s]],MpSo:[[t]],"u\\k=":[[m,[["a",u]]]],"v\u003CK]":[["arangoDB,Express,GCP"]],"ysX^":[["Yes"]],title:[[v]]},content:[w,x,y,z,A,B,C,D,E,F,G,H,n,I,J,K,L,M,N,O,P],created_time:1705347196198,last_edited_time:Q,parent_id:o,parent_table:R,alive:c,file_ids:["8a66f42a-1ea4-45b0-9fa2-e32714776afb","0d5fccd7-d344-474c-8c43-3261a33ba7e5"],created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"9c1dd87b-0464-49af-b1e3-07dca70f6b61":{value:{id:"9c1dd87b-0464-49af-b1e3-07dca70f6b61",version:144,type:"collection_view_page",view_ids:["b9fd954b-349b-46bb-8995-677927518ae7"],collection_id:o,format:{collection_pointer:{id:o,table:R,spaceId:d},copied_from_pointer:{id:S,table:g,spaceId:"0c084d44-207c-426c-8c5d-e7e6e298949b"}},permissions:[{role:"editor",type:"user_permission",user_id:a},{role:e,type:"public_permission",added_timestamp:1674543078967,allow_duplicate:i}],created_by:T,created_time:1674543065659,last_edited_by:T,last_edited_time:Q,parent_id:d,parent_table:"space",alive:c,copied_from:S,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"75f89bb1-74c5-4f73-bccc-3bfb8850b727":{value:{id:w,version:l,type:h,created_time:U,last_edited_time:1705436620472,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"a572cde0-c579-4eef-a2e1-69dbb6f2a671":{value:{id:x,version:1374,type:h,properties:{title:[["One of my clients was requesting to have a comments feature built into an existing mobile app where users would be able to express their opinions on posts. I had to satisfy the following requirements considering that it was an early stage startup:"]]},created_time:U,last_edited_time:1705446433646,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"521d8e52-190f-4d9f-9d60-ee67828cfe65":{value:{id:y,version:43,type:k,properties:{title:[["Cost effective"]]},created_time:1705442375792,last_edited_time:1705442878281,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"0e193eca-3bc1-4e31-9169-f8d26cbc3bcb":{value:{id:z,version:166,type:k,properties:{title:[["Long Term Scalability"]]},created_time:1705442878565,last_edited_time:1705446390226,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"abc71529-994e-4f10-bd25-d4e38c3ba328":{value:{id:A,version:V,type:h,created_time:W,last_edited_time:1705445745947,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"a4c433bd-be52-4f5d-896d-9dedd120cb3e":{value:{id:B,version:1484,type:h,properties:{title:[["I knew I had to start with a graph database to be able to support this feature and consider future growth. Firestore was just not going to align with future scalability given that we would eventually need aggregation features as well as search and recommendations support. Having surveyed several options on the market, ArangoDB positioned itself as a strong solution given the maturity of the product and being open source. "]]},created_time:W,last_edited_time:1705448090316,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"b7cbf42e-02ff-46b4-a4ea-5a35a030261a":{value:{id:C,version:V,type:h,created_time:p,last_edited_time:1705447822414,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"bd00f34b-c074-4144-9218-0b1fd6af21d3":{value:{id:D,version:338,type:h,properties:{title:[["The end result was a single instance deployment of arangoDB on Google Compute Engine costing about $40 a month."]]},created_time:p,last_edited_time:1705447948610,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"a842e5fb-08ca-46d9-ab5f-482451cf4877":{value:{id:E,version:4,type:h,created_time:1705447949221,last_edited_time:1705447949224,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"be7d68af-519a-4590-84d9-463962ed4d1c":{value:{id:F,version:250,type:h,properties:{title:[["This is a high level overview of the graph structure:"]]},created_time:p,last_edited_time:1705448203774,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"b0cc190f-0771-43cc-8905-7cc10fab0c6b":{value:{id:G,version:20,type:X,properties:{size:[["95.1KB"]],title:[[m]],source:[[Y]]},format:{block_width:480,display_source:Y,block_alignment:Z,block_full_width:i,block_page_width:i,block_aspect_ratio:.6306122448979592,block_preserve_scale:c},created_time:1705436412978,last_edited_time:1705436687062,parent_id:f,parent_table:g,alive:c,file_ids:["b094a298-c832-4111-87db-b525a4a85bbe"],created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"323e0ef2-dc49-4b08-b532-a6cfe73fe10e":{value:{id:H,version:10,type:h,created_time:j,last_edited_time:1705445942921,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"3c3babb7-4085-4992-a99a-d5b2effea85b":{value:{id:n,version:898,type:h,properties:{title:[["In this example we are using the "],[q,[["eoi",_]]],[" package to interact with arangoDB. We use a transaction to ensure necessary nodes and edges are created."]]},created_time:j,last_edited_time:1705503896189,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"78fd2fb5-73ec-4641-be37-68b5a6aa71d0":{value:{id:_,version:3,type:"external_object_instance",format:{domain:"github.com",use_crdt:i,original_url:"https:\u002F\u002Fgithub.com\u002Farangodb\u002Farangojs"},created_time:$,last_edited_time:$,parent_id:n,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"d540856c-126c-459c-990f-199b83c2843c":{value:{id:I,version:32,type:"code",properties:{title:[["try {\n      const arangoClient = await arangoDBClient;\n      const commentsCollection = arangoClient.collection('comments');\n      const postsCollection = arangoClient.collection('posts');\n      const usersCollection = arangoClient.collection('users');\n      const relationsEdge = arangoClient.collection('relations');\n\n      const { verified_uid } = req;\n      const { postId, comment } = req.body;\n\n      const trx = await arangoClient.beginTransaction({\n        write: [commentsCollection, postsCollection, usersCollection, relationsEdge],\n      });\n\n      const commentNode = await trx.step(() =\u003E\n        arangoClient.query(aql`\n        INSERT {\n          comment: ${comment},\n          userId: ${verified_uid},\n          display: ${true},\n          createdAt: DATE_NOW()\n        } INTO ${commentsCollection}\n        LET inserted = NEW\n        RETURN inserted._key\n      `)\n      );\n      const commentNodeResult = commentNode ? await commentNode.all() : [];\n      const commentNodeId = commentNodeResult.length ? commentNodeResult[0] : null;\n\n      \u002F\u002F upsert the post node since the post might already exist\n      await trx.step(() =\u003E\n        arangoClient.query(aql`\n        UPSERT { _key: ${postId} }\n        INSERT { _key: ${postId}, following: 0, comments: 1, createdAt: DATE_NOW() }\n        UPDATE { comments: OLD.comments + 1, updatedAt: DATE_NOW() } IN ${postsCollection}\n        RETURN { doc: NEW, type: OLD ? 'update' : 'insert' }\n      `)\n      );\n\n      \u002F\u002F upsert the user node since the user might already exist\n      await trx.step(() =\u003E\n        arangoClient.query(aql`\n        UPSERT { _key: ${verified_uid} }\n        INSERT { _key: ${verified_uid}, following: 0, comments: 1, createdAt: DATE_NOW() }\n        UPDATE { comments: OLD.comments + 1, updatedAt: DATE_NOW() } IN ${usersCollection}\n        RETURN { doc: NEW, type: OLD ? 'update' : 'insert' }\n      `)\n      );\n\n      const fromPost = `${POSTS_DOC_COLLECTION}\u002F${postId}`;\n      const fromUser = `${USERS_DOC_COLLECTION}\u002F${verified_uid}`;\n      const toComment = `${COMMENTS_DOC_COLLECTION}\u002F${commentNodeId}`;\n\n      \u002F\u002F create HAS_COMMENT edge from post node to comment node\n      await trx.step(() =\u003E\n        arangoClient.query(aql`\n        INSERT {\n          _from: ${fromPost},\n          _to: ${toComment},\n          edge: ${'HAS_COMMENT'},\n          createdAt: DATE_NOW()\n        } INTO ${relationsEdge}\n      `)\n      );\n\n      \u002F\u002F create CREATES_COMMENT edge from user node to comment node\n      await trx.step(() =\u003E\n        arangoClient.query(aql`\n        INSERT {\n          _from: ${fromUser},\n          _to: ${toComment},\n          edge: ${'CREATES_COMMENT'},\n          createdAt: DATE_NOW()\n        } INTO ${relationsEdge}\n      `)\n      );\n\n      await trx.commit();\n\n      return res.status(201).json({ id: commentNodeId });\n    } catch (error) {\n      console.error(error);\n      return res.status(500).json({ type: error.name, message: error.message });\n    }"]],language:[["JavaScript"]]},created_time:j,last_edited_time:1705445889634,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"d67ff9e5-4285-488b-ad20-63329227dc77":{value:{id:J,version:l,type:h,created_time:j,last_edited_time:1705441197662,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"465e8a62-449b-41a5-81cb-b7967cbf498d":{value:{id:K,version:l,type:h,created_time:j,last_edited_time:1705441197819,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"9a140f7e-4df3-4d81-91f2-57db1adba02b":{value:{id:L,version:303,type:h,properties:{title:[["As this feature matures there is potential for growth in several areas:"]]},created_time:j,last_edited_time:1705448381397,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"f7ccea0a-1834-4956-bf64-f1af643a8ec3":{value:{id:M,version:263,type:k,properties:{title:[["Setup of an Active Failover instance to support a more robust deployment"]]},created_time:1705448295309,last_edited_time:1705448397390,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"1ccae89c-3602-41d6-91a6-49d1ea60281e":{value:{id:N,version:l,type:k,properties:{title:[["Auto censor comments"]]},created_time:1705448355331,last_edited_time:1705448355788,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"5435bf97-eee5-436e-830c-9cd7af2c6f4a":{value:{id:O,version:77,type:k,properties:{title:[["Support comment reply"]]},created_time:1705446993441,last_edited_time:1705447000850,parent_id:f,parent_table:g,alive:c,created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e},"77f48bf3-a2e6-4874-a8e2-ff3c365acc10":{value:{id:P,version:40,type:X,properties:{size:[["127.6KB"]],title:[["Screenshot 2024-01-16 at 14.21.16.png"]],source:[[aa]]},format:{block_width:528,display_source:aa,block_alignment:Z,block_full_width:i,block_page_width:i,block_aspect_ratio:.6976744186046512,block_preserve_scale:c},created_time:1705436495376,last_edited_time:1705503235719,parent_id:f,parent_table:g,alive:c,file_ids:["f3d5f934-0a93-4184-98e2-326283ac3f6d"],created_by_table:b,created_by_id:a,last_edited_by_table:b,last_edited_by_id:a,space_id:d},role:e}},page:{id:f,created_at:r,description:s,slug:t,thumbnail:[{name:m,url:"https:\u002F\u002Fwww.notion.so\u002Fimage\u002Fhttps:%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2F47a01032-533f-4ceb-bcb9-a3dc11827e3b%2F0d5fccd7-d344-474c-8c43-3261a33ba7e5%2FScreenshot_2024-01-03_at_21.35.19.png?table=block&id=009af739-32c9-4247-8d75-69db84eae7f7&cache=v2",rawUrl:u}],tags:["arangoDB","Express","GCP"],public:c,title:v}}],fetch:{},mutations:void 0}}("0ba378f9-5b11-430d-9082-a2e34abcf232","notion_user",true,"47a01032-533f-4ceb-bcb9-a3dc11827e3b","comment_only","009af739-32c9-4247-8d75-69db84eae7f7","block","text",false,1705436487778,"bulleted_list",6,"Screenshot 2024-01-03 at 21.35.19.png","3c3babb7-4085-4992-a99a-d5b2effea85b","37d78f77-e97d-4340-a3e5-d0d39dcf4600",1705436638842,"‣","2024-01-16","Let’s take a dive into how we can use arangoDB to model social relationships","arangodb-comments","https:\u002F\u002Fprod-files-secure.s3.us-west-2.amazonaws.com\u002F47a01032-533f-4ceb-bcb9-a3dc11827e3b\u002F0d5fccd7-d344-474c-8c43-3261a33ba7e5\u002FScreenshot_2024-01-03_at_21.35.19.png","Support a User Comments Feature with ArangoDB","75f89bb1-74c5-4f73-bccc-3bfb8850b727","a572cde0-c579-4eef-a2e1-69dbb6f2a671","521d8e52-190f-4d9f-9d60-ee67828cfe65","0e193eca-3bc1-4e31-9169-f8d26cbc3bcb","abc71529-994e-4f10-bd25-d4e38c3ba328","a4c433bd-be52-4f5d-896d-9dedd120cb3e","b7cbf42e-02ff-46b4-a4ea-5a35a030261a","bd00f34b-c074-4144-9218-0b1fd6af21d3","a842e5fb-08ca-46d9-ab5f-482451cf4877","be7d68af-519a-4590-84d9-463962ed4d1c","b0cc190f-0771-43cc-8905-7cc10fab0c6b","323e0ef2-dc49-4b08-b532-a6cfe73fe10e","d540856c-126c-459c-990f-199b83c2843c","d67ff9e5-4285-488b-ad20-63329227dc77","465e8a62-449b-41a5-81cb-b7967cbf498d","9a140f7e-4df3-4d81-91f2-57db1adba02b","f7ccea0a-1834-4956-bf64-f1af643a8ec3","1ccae89c-3602-41d6-91a6-49d1ea60281e","5435bf97-eee5-436e-830c-9cd7af2c6f4a","77f48bf3-a2e6-4874-a8e2-ff3c365acc10",1705505863591,"collection","ceef6f1a-895a-46b2-a0e4-a87b41405547","204e031f-f12d-445c-ba1d-df7a7bbebfbc",1705436388023,8,1705443068035,"image","https:\u002F\u002Fprod-files-secure.s3.us-west-2.amazonaws.com\u002F47a01032-533f-4ceb-bcb9-a3dc11827e3b\u002Fb094a298-c832-4111-87db-b525a4a85bbe\u002FScreenshot_2024-01-03_at_21.35.19.png","left","78fd2fb5-73ec-4641-be37-68b5a6aa71d0",1705446124678,"https:\u002F\u002Fprod-files-secure.s3.us-west-2.amazonaws.com\u002F47a01032-533f-4ceb-bcb9-a3dc11827e3b\u002Ff3d5f934-0a93-4184-98e2-326283ac3f6d\u002FScreenshot_2024-01-16_at_14.21.16.png")));